# Выгрузка отчетов Яндекс Метрики

Получение отчетов Яндекс Метрики напрямую в Power BI или Excel.

Функция работает с API отчетов 1 версии: https://yandex.ru/dev/direct/doc/reports/reports-docpage/
## Инструкция по работе
1. Для начала залогиньтесь в нужном аккаунте Яндекс и получите токен авторизации по ссылке: https://oauth.yandex.ru/authorize?response_type=token&client_id=764f4af41256427ba87965a7ed31ea3d
1. Согласитесь предоставить доступ к аккаунту (кроме вас им никто не сможет воспользоваться, если, конечно, вы не отдадите кому-то свой токен). Дополнительная информация: https://yandex.ru/dev/direct/doc/start/token-docpage/
1. Скопируйте токен
1. Создайте новый пустой запрос в Power Query для Power Bi или Excel и вставьте в него исходный код функции 
1. Вставьте токен в поле функции "Авторизационный токен" и заполните остальные параметры функции на свой вкус.
1. Выполните функцию.

## Описание параметров
Все параметры необязательные, но без токена ничего не выйдет.

Параметр|Тип|Значение по умолчанию|Описание
--------|---|---------------------|---
Дата начала интервала|date|7 дней назад|Дата начала отчета не позднее сегодняшней
Дата окончания интервала|date|сегодня|Дата окончания отчета не позднее даты начала
Группировка по дате|text|all|Допустимые значения см. ниже.
Список группировок (dimensions) через запятую|text|пусто|Поля можно передать в виде списка или срокой с любым их разделителей "#(tab) ,;". Не более 10 группировок из списка https://yandex.ru/dev/metrika/doc/api2/api_v1/attrandmetr/dim_all-docpage/
Список метрик (metrics) через запятую|text|пусто|Поля можно передать в виде списка или срокой с любым их разделителей "#(tab) ,;". Не более 20 метрик из списка https://yandex.ru/dev/metrika/doc/api2/api_v1/attrandmetr/dim_all-docpage/
Шаблон (preset)|text|sources_summary|Возможные шаблоны https://yandex.ru/dev/metrika/doc/api2/api_v1/presets/presets-docpage/
Фильтр сегмента (filters)|text|пусто|Корректная строка фильтра https://yandex.ru/dev/metrika/doc/api2/api_v1/segmentation-docpage/
Идентификатор цели|number|пусто|Укажите идентификатор цели - его можно посмотреть в настройках Яндекс Метрики
Номер счетчика Яндекс.Метрики|number|44147844|Ищите номер счетчика в Метрике нужного сайта или на странице https://metrika.yandex.ru/list
Авторизационный токен|text|05...0037|Для начала работы залогиньтесь в нужном аккаунте Яндекс и получите токен авторизации по ссылке: https://oauth.yandex.ru/authorize?response_type=token&client_id=764f4af41256427ba87965a7ed31ea3d

Допустимые значения параметра "Группировка по дате"
* all — временной интервал не разбивается.
* auto — интервал устанавливается с учетом выбранного отчетного периода и количества данных, достаточного для этого периода.
* minutes — временной интервал разбивается на интервалы из некоторого количества минут.
* dekaminute — временной интервал разбивается на 10-минутные интервалы.
* minute — временной интервал разбивается на минутные интервалы.
* hour — временной интервал разбивается на часовые интервалы.
* hours — временной интервал разбивается на интервалы из нескольких часов.
* day — временной интервал разбивается по дням.
* week — временной интервал разбивается по неделям.
* month — временной интервал разбивается по месяцам.
* quarter — временной интервал разбивается по кварталам.
* year — временной интервал разбивается по годам

## Повышение собственной производительности
Несколько советов, помогающих упростить вашу работу:
* Укажите номер счетчика и токен в коде в строках 21 и 22, чтобы не вводить их каждый раз

## Вопросы
С вопросами и предложениями стучитесь:
* в фейсбук https://www.facebook.com/iliah.nazarov
* в телеграм https://t.me/IlyaNazarov
